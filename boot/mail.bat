@ECHO OFF
SETLOCAL
IF [%1]==[] GOTO _extract

SET _folder=%1
SET _folder=%_folder:~0,1%

IF /I %_folder%==i (
        SET _folder=incoming
        GOTO _extract
        )
IF /I %_folder%==o (
        SET _folder=outgoing
        GOTO _extract
        )
ECHO Parameter must starts with either I^(ncoming^) or O^(outgoing^) !!!
GOTO:EOF

:_extract
IF EXIST D:\Downloads\[????????_??????]_[*.eml move D:\Downloads\[????????_??????]_[*.eml D:\Mail\tmp\ >NUL
IF EXIST D:\downloads\cryoon*.zip (
		7z e -scsUTF-8 -od:\mail\tmp\ d:\downloads\cryoon*.zip
		del d:\downloads\cryoon*.zip
        )
IF EXIST D:\Mail\tmp\[????????_??????]_[*_eml (
        PUSHD D:\Mail\tmp\
        REN [????????_??????]_[*_eml [????????_??????]_[*_.eml
        POPD
        )
IF EXIST D:\Mail\tmp\[????????_??????]_[*.eml (
        PUSHD D:\Mail\tmp\
        IF EXIST [????????_??????]_[cryoon@deviceeng.co.kr]*.eml (
            move /y [????????_??????]_[cryoon@deviceeng.co.kr]*.eml D:\Mail\outgoing\
            )
        IF EXIST [????????_??????]_[*.eml (
            move /y [????????_??????]_[*.eml D:\Mail\incoming\
            )
        POPD
		)

:_openmail
TASKLIST | FINDSTR /i gvim.exe >NUL
IF %ERRORLEVEL% NEQ 0 START "GW Mail" /B gvim d:\mail\%_folder%
ENDLOCAL
